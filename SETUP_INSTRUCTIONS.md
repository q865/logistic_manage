# Инструкции по установке и настройке

## Предварительные требования

- Node.js версии 18 или выше
- npm или yarn
- Git

## Установка

### 1. Клонирование репозитория

```bash
git clone <your-repo-url>
cd tgBotGruzServis
```

### 2. Установка зависимостей

```bash
npm install
```

### 3. Настройка переменных окружения

Скопируйте файл `.env.example` в `.env` и заполните необходимые значения:

```bash
cp env.example .env
```

Отредактируйте `.env` файл:

```env
# Telegram Bot Token (получите у @BotFather)
BOT_TOKEN=your_bot_token_here

# База данных
DB_HOST=localhost
DB_PORT=5432
DB_NAME=gruzservis
DB_USER=your_username
DB_PASSWORD=your_password

# Другие настройки
NODE_ENV=development
PORT=3000
```

## Запуск

### Режим разработки

```bash
npm run dev
```

### Продакшн режим

```bash
npm run build
npm start
```

## Тестирование

### Запуск тестов

```bash
npm test
```

### Тестирование парсера

```bash
node test_excel_parser.mjs
```

### Тестирование реального парсинга

```bash
node test_real_parsing.mjs
```

## Структура проекта

```
tgBotGruzServis/
├── src/
│   ├── parsers/
│   │   └── excelParser.js      # Основной парсер Excel
│   ├── bot/                    # Логика Telegram бота
│   ├── database/               # Работа с базой данных
│   └── utils/                  # Вспомогательные функции
├── examples/
│   └── telegram_bot_integration.js  # Пример интеграции
├── tests/                      # Тесты
├── templates/                  # Шаблоны сообщений
└── webapp/                     # Веб-интерфейс
```

## Настройка Telegram бота

### 1. Получение токена

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Скопируйте полученный токен в `.env` файл

### 2. Настройка команд бота

Отправьте @BotFather команду `/setcommands` и следующий список:

```
start - Начать работу с ботом
help - Показать справку
test - Протестировать парсер
upload - Загрузить Excel файл
status - Статус обработки
```

## Использование ExcelParser

### Базовое использование

```javascript
import ExcelParser from './src/parsers/excelParser.js';

// Парсинг строки данных
const rowData = [
  "01.09.25_77_00ч_ВИП_19",
  "3.32 куб.м/871 кг/1.010 м/Нет",
  "13908.Заказано.01\\.09\\.2025 00:00:00.Кулушов Марат Шайлообаевич........01\\.09\\.2025 01:30:00..202",
  'ООО "ГРУЗ СЕРВИС"'
];

const parsedData = ExcelParser.parseRow(rowData);

if (ExcelParser.validate(parsedData)) {
  const formatted = ExcelParser.format(parsedData);
  console.log(formatted);
}
```

### Интеграция с ботом

См. файл `examples/telegram_bot_integration.js` для полного примера.

## Форматы данных

### Поддерживаемые форматы Excel

- **Маршрут**: `01.09.25_77_00ч_ВИП_19`
- **Груз**: `3.32 куб.м/871 кг/1.010 м/Нет`
- **Заказ**: `13908.Заказано.01\.09\.2025 00:00:00.Кулушов Марат Шайлообаевич........01\.09\.2025 01:30:00..202`
- **Компания**: `ООО "ГРУЗ СЕРВИС"`

## Устранение неполадок

### Ошибки парсинга

1. Проверьте формат данных в Excel файле
2. Убедитесь, что все обязательные поля заполнены
3. Проверьте экранирование символов

### Ошибки бота

1. Проверьте токен в `.env` файле
2. Убедитесь, что бот не заблокирован
3. Проверьте логи в консоли

### Ошибки базы данных

1. Проверьте подключение к базе данных
2. Убедитесь, что база создана и доступна
3. Проверьте права доступа пользователя

## Разработка

### Добавление новых функций

1. Создайте ветку для новой функции
2. Реализуйте функциональность
3. Добавьте тесты
4. Создайте Pull Request

### Структура кода

- Используйте ES6+ синтаксис
- Следуйте принципам SOLID
- Добавляйте JSDoc комментарии
- Пишите тесты для новой функциональности

## Деплой

### Docker (рекомендуется)

```bash
docker build -t gruzservis-bot .
docker run -d --name gruzservis-bot gruzservis-bot
```

### Ручной деплой

1. Скопируйте файлы на сервер
2. Установите зависимости: `npm install --production`
3. Настройте переменные окружения
4. Запустите: `npm start`

## Мониторинг

### Логи

Логи выводятся в консоль. Для продакшена рекомендуется настроить логирование в файл или внешний сервис.

### Метрики

Бот автоматически собирает базовые метрики:
- Количество обработанных файлов
- Время обработки
- Количество ошибок

## Поддержка

При возникновении проблем:

1. Проверьте раздел "Устранение неполадок"
2. Изучите логи в консоли
3. Создайте Issue в репозитории
4. Опишите проблему и приложите логи

## Лицензия

Проект распространяется под лицензией MIT. См. файл LICENSE для подробностей.
