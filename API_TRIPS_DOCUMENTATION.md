# üöó API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏

## –û–±–∑–æ—Ä

API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–π—Å–∞–º–∏ (trips) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, —á—Ç–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–π—Å–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ "–ì—Ä—É–∑ –°–µ—Ä–≤–∏—Å".

**–ë–∞–∑–æ–≤—ã–π URL**: `http://localhost:3000/api/trips`

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

> **–í–Ω–∏–º–∞–Ω–∏–µ**: –í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ API –ø—É–±–ª–∏—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

## üìã –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### Trip (–†–µ–π—Å)

```typescript
interface Trip {
  id?: number;                    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
  driver_id: number;              // ID –≤–æ–¥–∏—Ç–µ–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  delivery_id: number | null;     // ID –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  route_info: string;             // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  status: TripStatus;             // –°—Ç–∞—Ç—É—Å —Ä–µ–π—Å–∞
  notes: string | null;           // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏
  created_at?: Date;              // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  updated_at?: Date;              // –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

### TripStatus (–°—Ç–∞—Ç—É—Å—ã —Ä–µ–π—Å–∞)

```typescript
enum TripStatus {
  'review'        // –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
  'with_driver'   // –£ –≤–æ–¥–∏—Ç–µ–ª—è
  'rework'        // –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ
  'lost'          // –£—Ç–µ—Ä—è–Ω—ã
  'verified'      // –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã
}
```

## üöÄ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–∞

**POST** `/api/trips`

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ä–µ–π—Å –≤ —Å–∏—Å—Ç–µ–º–µ.

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "driver_id": 1,
  "delivery_id": 123,
  "route_info": "01.09.25_77_00—á_–í–ò–ü_19 - –ú–æ—Å–∫–≤–∞-–°–ü–±",
  "status": "review",
  "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞"
}
```

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

- `driver_id` - ID –≤–æ–¥–∏—Ç–µ–ª—è
- `route_info` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": {
    "id": 1,
    "driver_id": 1,
    "delivery_id": 123,
    "route_info": "01.09.25_77_00—á_–í–ò–ü_19 - –ú–æ—Å–∫–≤–∞-–°–ü–±",
    "status": "review",
    "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
    "created_at": "2025-09-01T08:30:00.000Z",
    "updated_at": "2025-09-01T08:30:00.000Z"
  },
  "message": "–†–µ–π—Å —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–µ–π—Å–æ–≤

**GET** `/api/trips`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ–π—Å–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

- `page` - –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1)
- `limit` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20)
- `status` - –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
- `driver_id` - –§–∏–ª—å—Ç—Ä –ø–æ –≤–æ–¥–∏—Ç–µ–ª—é

#### –ü—Ä–∏–º–µ—Ä—ã

```bash
# –í—Å–µ —Ä–µ–π—Å—ã
GET /api/trips

# –†–µ–π—Å—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
GET /api/trips?status=review

# –†–µ–π—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è
GET /api/trips?driver_id=1

# –ü–∞–≥–∏–Ω–∞—Ü–∏—è
GET /api/trips?page=2&limit=10
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "driver_id": 1,
      "route_info": "01.09.25_77_00—á_–í–ò–ü_19",
      "status": "review",
      "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      "created_at": "2025-09-01T08:30:00.000Z",
      "updated_at": "2025-09-01T08:30:00.000Z"
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 1,
    "totalPages": 1
  }
}
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–π—Å–∞ –ø–æ ID

**GET** `/api/trips/:id`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ–π—Å –ø–æ –µ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

- `id` - ID —Ä–µ–π—Å–∞

#### –ü—Ä–∏–º–µ—Ä

```bash
GET /api/trips/1
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": {
    "id": 1,
    "driver_id": 1,
    "route_info": "01.09.25_77_00—á_–í–ò–ü_19",
    "status": "review",
    "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
    "created_at": "2025-09-01T08:30:00.000Z",
    "updated_at": "2025-09-01T08:30:00.000Z"
  }
}
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –≤–æ–¥–∏—Ç–µ–ª—è

**GET** `/api/trips/driver/:driverId`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Ä–µ–π—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–æ–¥–∏—Ç–µ–ª—è.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

- `driverId` - ID –≤–æ–¥–∏—Ç–µ–ª—è

#### –ü—Ä–∏–º–µ—Ä

```bash
GET /api/trips/driver/1
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "driver_id": 1,
      "route_info": "01.09.25_77_00—á_–í–ò–ü_19",
      "status": "review",
      "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
      "created_at": "2025-09-01T08:30:00.000Z",
      "updated_at": "2025-09-01T08:30:00.000Z"
    }
  ],
  "count": 1
}
```

### 5. –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–π—Å–∞

**PUT** `/api/trips/:id/status`

–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ä–µ–π—Å–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

- `id` - ID —Ä–µ–π—Å–∞

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "status": "with_driver"
}
```

#### –ü—Ä–∏–º–µ—Ä

```bash
PUT /api/trips/1/status
Content-Type: application/json

{
  "status": "with_driver"
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": {
    "id": 1,
    "driver_id": 1,
    "route_info": "01.09.25_77_00—á_–í–ò–ü_19",
    "status": "with_driver",
    "notes": "–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
    "created_at": "2025-09-01T08:30:00.000Z",
    "updated_at": "2025-09-01T08:30:00.000Z"
  },
  "message": "–°—Ç–∞—Ç—É—Å —Ä–µ–π—Å–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
}
```

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞

**PUT** `/api/trips/:id`

–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ä–µ–π—Å–∞.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

- `id` - ID —Ä–µ–π—Å–∞

#### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "route_info": "–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ",
  "notes": "–ù–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏",
  "status": "verified"
}
```

#### –ü—Ä–∏–º–µ—Ä

```bash
PUT /api/trips/1
Content-Type: application/json

{
  "route_info": "01.09.25_77_00—á_–í–ò–ü_19 - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç",
  "notes": "–†–µ–π—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω",
  "status": "verified"
}
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "data": {
    "id": 1,
    "driver_id": 1,
    "route_info": "01.09.25_77_00—á_–í–ò–ü_19 - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç",
    "status": "verified",
    "notes": "–†–µ–π—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω",
    "created_at": "2025-09-01T08:30:00.000Z",
    "updated_at": "2025-09-01T08:30:00.000Z"
  },
  "message": "–†–µ–π—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
}
```

### 7. –£–¥–∞–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞

**DELETE** `/api/trips/:id`

–£–¥–∞–ª—è–µ—Ç —Ä–µ–π—Å –∏–∑ —Å–∏—Å—Ç–µ–º—ã.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏

- `id` - ID —Ä–µ–π—Å–∞

#### –ü—Ä–∏–º–µ—Ä

```bash
DELETE /api/trips/1
```

#### –û—Ç–≤–µ—Ç

```json
{
  "success": true,
  "message": "–†–µ–π—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
}
```

## üîç –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### HTTP —Å—Ç–∞—Ç—É—Å—ã

- `200` - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- `201` - –†–µ—Å—É—Ä—Å —Å–æ–∑–¥–∞–Ω
- `400` - –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- `404` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `500` - –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫

```json
{
  "success": false,
  "error": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏",
  "details": "–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)"
}
```

### –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

#### –í–∞–ª–∏–¥–∞—Ü–∏—è

```json
{
  "success": false,
  "error": "driver_id –∏ route_info –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã"
}
```

#### –ù–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å

```json
{
  "success": false,
  "error": "–ù–µ–≤–µ—Ä–Ω—ã–π —Å—Ç–∞—Ç—É—Å. –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: review, with_driver, rework, lost, verified"
}
```

#### –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω

```json
{
  "success": false,
  "error": "–†–µ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test_trip_api.mjs`:

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
node test_trip_api.mjs

# –ò–ª–∏ —Å –ø–æ–º–æ—â—å—é curl
curl -X POST http://localhost:3000/api/trips \
  -H "Content-Type: application/json" \
  -d '{"driver_id": 1, "route_info": "–¢–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç"}'
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–π—Å–∞ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è

```javascript
const response = await fetch('/api/trips', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    driver_id: 1,
    route_info: '01.09.25_77_00—á_–í–ò–ü_19 - –ú–æ—Å–∫–≤–∞-–°–ü–±',
    status: 'review',
    notes: '–°—Ä–æ—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'
  })
});

const result = await response.json();
console.log('–°–æ–∑–¥–∞–Ω —Ä–µ–π—Å:', result.data);
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–π—Å–æ–≤ –≤–æ–¥–∏—Ç–µ–ª—è

```javascript
const response = await fetch('/api/trips/driver/1');
const result = await response.json();

if (result.success) {
  console.log(`–£ –≤–æ–¥–∏—Ç–µ–ª—è ${result.count} —Ä–µ–π—Å–æ–≤:`);
  result.data.forEach(trip => {
    console.log(`- –†–µ–π—Å ${trip.id}: ${trip.route_info} (${trip.status})`);
  });
}
```

### –°–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ä–µ–π—Å–∞

```javascript
const response = await fetch('/api/trips/1/status', {
  method: 'PUT',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ status: 'with_driver' })
});

const result = await response.json();
if (result.success) {
  console.log('–°—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–µ–Ω –Ω–∞:', result.data.status);
}
```

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é Joi/Zod
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel/CSV
- [ ] –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–π—Å–æ–≤)
